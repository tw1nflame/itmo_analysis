# Анализ и выявление мошеннических транзакций

Этот проект представляет собой комплексный анализ данных о финансовых транзакциях с целью выявления паттернов мошенничества. В рамках проекта были проверены продуктовые и технические гипотезы, а также построена и оценена модель машинного обучения для классификации операций.

**Используемые технологии:**
- **Обработка данных:** Polars
- **Машинное обучение:** Scikit-learn, LightGBM
- **Визуализация:** Plotly, Seaborn, Matplotlib

## Содержание
- [Этапы проекта](#этапы-проекта)
- [Ключевые выводы и гипотезы (EDA)](#ключевые-выводы-и-гипотезы-eda)
- [Результаты модели машинного обучения](#результаты-модели-машинного-обучения)
- [Итоговые рекомендации](#итоговые-рекомендации)
- [Как запустить](#как-запустить)

## Этапы проекта

Проект был разделен на несколько ключевых этапов:

1.  **Подготовка и загрузка данных:**
    - Загрузка основного датасета транзакций и данных о курсах валют из `.parquet` файлов.
    - Первичный анализ данных: проверка на наличие пропущенных значений и дубликатов. Было обнаружено **12,913** дубликатов по `transaction_id`.

2.  **Предобработка и инжиниринг признаков (Feature Engineering):**
    - **Конвертация валют:** Все суммы транзакций были переведены в USD для сопоставимости.
    - **Обработка вложенных данных:** Структурированный столбец `last_hour_activity` был разобран на отдельные признаки (например, `lha_num_transactions`).
    - **Создание временных признаков:** Из `timestamp` были извлечены час дня и день недели для анализа временных паттернов.

3.  **Разведочный анализ данных (EDA):**
    - Визуальный и статистический анализ данных для поиска закономерностей и выдвижения гипотез.
    - Анализ распределения мошеннических операций по числовым (сумма транзакции) и категориальным (страна, тип карты) признакам.
    - Выявлена сильная несбалансированность классов: **20%** транзакций являются мошенническими.

4.  **Проверка гипотез и финальная подготовка данных:**
    - **Удаление дубликатов** и столбцов, приводящих к **утечке данных (data leakage)**, таких как `channel` и `is_card_present`.
    - Статистическая проверка гипотез, сформулированных на этапе EDA, для подтверждения их значимости.

5.  **Построение и оценка модели машинного обучения (ML):**
    - Данные были разделены на обучающую и тестовую выборки по времени (80/20).
    - Был создан `Pipeline`, включающий `OneHotEncoder` для категориальных признаков и классификатор `LightGBM`.
    - Модель была обучена и оценена на отложенной выборке по ключевым метрикам.

## Ключевые выводы и гипотезы (EDA)

### Продуктовые гипотезы (для бизнеса)
*   **Гео-ориентированный фрод:** Основной объём мошенничества генерируется из **Мексики, России, Бразилии и Нигерии**. Доля фрода в этих странах достигает **35-38%**.
*   **Риск путешествий:** Транзакции за пределами домашней страны клиента несут в **~20 раз больший риск** (56% фрода против 2.5%).
*   **Ночные атаки:** Мошенники активно эксплуатируют ночное время, с пиком активности в **1:00 ночи**.

### Технические гипотезы (для Data Science)
*   **Утечка данных (Data Leakage):** Признаки `channel` и `is_card_present` на 100% предсказывают мошенничество. Если `channel = 'pos'` или `is_card_present = true`, транзакция всегда является мошеннической. Эти признаки были исключены из обучения.
*   **Важность признаков:** Географические (`is_outside_home_country`, `country`) и временные (`hour_of_day`) признаки показали высокую предсказательную силу. В то же время, бизнес-признаки (`vendor_category`, `card_type`) и поведенческие (`last_hour_activity`) оказались малозначимыми.

## Результаты модели машинного обучения

Модель градиентного бустинга (LightGBM) показала исключительно высокие результаты на тестовой выборке.

| Метрика                     | Значение |
| --------------------------- | :------: |
| **Precision**               |  0.9793  |
| **Recall**                  |  0.9302  |
| **F1-score**                |  0.9541  |
| **ROC-AUC**                 |  0.9970  |
| **PR-AUC (ключевая метрика)** |  **0.9913**  |

**PR-AUC = 0.99** свидетельствует о том, что модель способна поддерживать высокую точность (минимизируя ложные блокировки) даже при высоком охвате мошеннических транзакций.

**Анализ важности признаков** в модели подтвердил выводы EDA: ключевую роль играют **сумма транзакции**, **тип карты** и **устройство**, с которого совершается операция.

## Итоговые рекомендации

### Для бизнес-подразделений
1.  **Внедрить модель в продуктив:** Модель обладает высочайшим качеством и может значительно снизить финансовые потери.
2.  **Усилить контроль за рисковыми сегментами:**
    - Ввести обязательную 2FA или более строгие лимиты для транзакций из стран с высоким уровнем фрода.
    - Усилить мониторинг за клиентами, совершающими трансграничные операции.
    - Внедрить "ночной режим" с пониженными лимитами или дополнительными проверками для операций в ночное время.
3.  **Пересмотреть оценку поведенческих рисков:** Предоставленные метрики `last_hour_activity` неэффективны. Необходимо разработать новые поведенческие признаки, основанные на истории клиента.

### Для команды Data Science
1.  **Провести аудит данных:** Устранить причину появления 100% фрода для `channel = 'pos'`, чтобы повысить надежность будущих моделей.
2.  **Разработать новые поведенческие признаки:** Сгенерировать более сложные метрики для выявления нетипичных транзакций (например, скорость смены геолокации, сравнение с историческим профилем трат).
3.  **Провести A/B тестирование:** Перед полномасштабным внедрением сравнить производительность новой модели с существующей антифрод-системой.
